<!doctype html>
<html lang="vi" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Auth Demo – Đăng nhập / Đăng ký</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons (tùy chọn) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body{min-height:100vh;display:flex;align-items:center;justify-content:center;background:#f7f7f9}
    .auth-card{max-width: 780px; width:100%}
    .password-meter .progress{height:6px}
    .cursor-pointer{cursor:pointer}
  </style>
</head>
<body>
  <div class="container px-3">
    <div class="card shadow-sm rounded-4 auth-card mx-auto">
      <div class="card-body p-4 p-md-5">
        <h3 class="mb-1">Xác thực người dùng</h3>
        <p class="text-muted mb-4">Giai đoạn 1 – HTML + Bootstrap (chưa cần backend)</p>

        <!-- Tabs -->
        <ul class="nav nav-pills gap-2 mb-4" id="authTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="login-tab" data-bs-toggle="pill"
              data-bs-target="#login-pane" type="button" role="tab" aria-controls="login-pane" aria-selected="true">
              <i class="bi bi-box-arrow-in-right me-1"></i> Đăng nhập
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="register-tab" data-bs-toggle="pill"
              data-bs-target="#register-pane" type="button" role="tab" aria-controls="register-pane" aria-selected="false">
              <i class="bi bi-person-plus me-1"></i> Đăng ký
            </button>
          </li>
        </ul>

        <div class="tab-content">
          <!-- LOGIN -->
          <div class="tab-pane fade show active" id="login-pane" role="tabpanel" aria-labelledby="login-tab">
            <form id="loginForm" class="row g-3 needs-validation" novalidate>
              <div class="col-12">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" name="email" placeholder="email@domain.com" required>
                <div class="invalid-feedback">Vui lòng nhập email hợp lệ.</div>
              </div>

              <div class="col-12">
                <label class="form-label">Mật khẩu</label>
                <div class="input-group">
                  <input type="password" class="form-control" name="password" placeholder="••••••••" required minlength="6">
                  <button class="btn btn-outline-secondary toggle-pass" type="button" data-target="loginForm">
                    <i class="bi bi-eye"></i>
                  </button>
                  <div class="invalid-feedback">Mật khẩu tối thiểu 6 ký tự.</div>
                </div>
              </div>

              <div class="col-12 d-grid d-md-flex gap-2">
                <button class="btn btn-primary px-4" type="submit">Đăng nhập</button>
                <button class="btn btn-outline-secondary" type="button" id="loginReset">Xóa trắng</button>
              </div>
            </form>
          </div>

          <!-- REGISTER -->
          <div class="tab-pane fade" id="register-pane" role="tabpanel" aria-labelledby="register-tab">
            <form id="registerForm" class="row g-3 needs-validation" novalidate>
              <div class="col-md-6">
                <label class="form-label">Họ và tên</label>
                <input type="text" class="form-control" name="fullname" placeholder="Nguyễn Văn A" required>
                <div class="invalid-feedback">Vui lòng nhập họ tên.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" name="email" placeholder="email@domain.com" required>
                <div class="invalid-feedback">Vui lòng nhập email hợp lệ.</div>
              </div>

              <div class="col-md-6">
                <label class="form-label">Mật khẩu</label>
                <div class="input-group">
                  <input type="password" class="form-control" name="password" placeholder="Tối thiểu 8 ký tự"
                         required minlength="8" aria-describedby="pwdHelp">
                  <button class="btn btn-outline-secondary toggle-pass" type="button" data-target="registerForm" data-name="password">
                    <i class="bi bi-eye"></i>
                  </button>
                  <div class="invalid-feedback">Mật khẩu tối thiểu 8 ký tự.</div>
                </div>
                <div id="pwdHelp" class="form-text">
                  Nên có chữ hoa, chữ thường, số và ký tự đặc biệt.
                </div>

                <!-- Strength meter -->
                <div class="password-meter mt-2">
                  <div class="progress">
                    <div id="pwdStrengthBar" class="progress-bar" style="width: 0%"></div>
                  </div>
                  <small id="pwdStrengthText" class="text-muted">Độ mạnh: —</small>
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label">Nhập lại mật khẩu</label>
                <div class="input-group">
                  <input type="password" class="form-control" name="confirm" placeholder="Nhập lại mật khẩu"
                         required minlength="8">
                  <button class="btn btn-outline-secondary toggle-pass" type="button" data-target="registerForm" data-name="confirm">
                    <i class="bi bi-eye"></i>
                  </button>
                  <div class="invalid-feedback">Mật khẩu nhập lại chưa khớp.</div>
                </div>
              </div>

              <div class="col-12 d-grid d-md-flex gap-2">
                <button class="btn btn-success px-4" type="submit">Đăng ký</button>
                <button class="btn btn-outline-secondary" type="button" id="regReset">Xóa trắng</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Alert area -->
        <div id="alertArea" class="mt-4"></div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ===== Helpers =====
    function showAlert(type, message) {
      const alert = document.createElement('div');
      alert.className = `alert alert-${type} alert-dismissible fade show`;
      alert.role = 'alert';
      alert.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      `;
      document.getElementById('alertArea').innerHTML = '';
      document.getElementById('alertArea').appendChild(alert);
    }

    // Toggle show/hide password
    document.querySelectorAll('.toggle-pass').forEach(btn => {
      btn.addEventListener('click', () => {
        const formId = btn.getAttribute('data-target');
        const inputName = btn.getAttribute('data-name'); // optional
        const form = document.getElementById(formId);
        const input = inputName ? form.querySelector(`input[name="${inputName}"]`) : form.querySelector('input[name="password"]');
        if (!input) return;

        input.type = input.type === 'password' ? 'text' : 'password';
        const icon = btn.querySelector('i');
        if (icon) icon.className = input.type === 'password' ? 'bi bi-eye' : 'bi bi-eye-slash';
      });
    });

    // Password strength checker (đơn giản)
    const regForm = document.getElementById('registerForm');
    const pwdInput = regForm.querySelector('input[name="password"]');
    const confirmInput = regForm.querySelector('input[name="confirm"]');
    const bar = document.getElementById('pwdStrengthBar');
    const txt = document.getElementById('pwdStrengthText');

    function scorePassword(pwd) {
      let score = 0;
      if (!pwd) return 0;
      // tiêu chí đơn giản
      if (pwd.length >= 8) score += 20;
      if (/[a-z]/.test(pwd)) score += 20;
      if (/[A-Z]/.test(pwd)) score += 20;
      if (/[0-9]/.test(pwd)) score += 20;
      if (/[^A-Za-z0-9]/.test(pwd)) score += 20;
      return Math.min(score, 100);
    }

    function updateStrength() {
      const val = pwdInput.value;
      const s = scorePassword(val);
      bar.style.width = s + '%';
      bar.classList.remove('bg-danger','bg-warning','bg-success');
      if (s < 40) { bar.classList.add('bg-danger'); txt.textContent = 'Độ mạnh: Yếu'; }
      else if (s < 80) { bar.classList.add('bg-warning'); txt.textContent = 'Độ mạnh: Trung bình'; }
      else { bar.classList.add('bg-success'); txt.textContent = 'Độ mạnh: Mạnh'; }
    }

    pwdInput.addEventListener('input', updateStrength);
    updateStrength();

    // Bootstrap validation + kiểm tra confirm mật khẩu
    (function(){
      // Đăng ký
      regForm.addEventListener('submit', function(e){
        e.preventDefault();
        e.stopPropagation();

        // Kiểm tra khớp mật khẩu
        const pwd = pwdInput.value;
        const cf = confirmInput.value;
        if (pwd !== cf) {
          confirmInput.setCustomValidity('not-match');
        } else {
          confirmInput.setCustomValidity('');
        }

        if (!regForm.checkValidity()) {
          regForm.classList.add('was-validated');
          showAlert('danger', 'Thông tin chưa hợp lệ. Vui lòng kiểm tra lại.');
          return;
        }

        // Giả lập lưu "tài khoản" vào localStorage (demo)
        const email = regForm.email.value.trim().toLowerCase();
        const fullname = regForm.fullname.value.trim();
        const users = JSON.parse(localStorage.getItem('users') || '{}');
        if (users[email]) {
          showAlert('warning', 'Email này đã tồn tại. Hãy dùng email khác.');
          return;
        }
        users[email] = {
          fullname,
          // Demo: Lưu thẳng password (KHÔNG làm vậy ở sản phẩm thật!)
          // Sau này chuyển sang: băm mật khẩu ở backend hoặc dùng đăng nhập bằng chữ ký blockchain.
          password: pwd
        };
        localStorage.setItem('users', JSON.stringify(users));

        regForm.reset();
        regForm.classList.remove('was-validated');
        updateStrength();
        showAlert('success', 'Đăng ký thành công! Bạn có thể chuyển sang tab Đăng nhập.');
        // Switch tab sang login
        const tabTrigger = document.querySelector('#login-tab');
        if (tabTrigger) new bootstrap.Tab(tabTrigger).show();
      });

      // Đăng nhập
      const loginForm = document.getElementById('loginForm');
      loginForm.addEventListener('submit', function(e){
        e.preventDefault();
        e.stopPropagation();

        if (!loginForm.checkValidity()) {
          loginForm.classList.add('was-validated');
          showAlert('danger', 'Thông tin chưa hợp lệ.');
          return;
        }
        const email = loginForm.email.value.trim().toLowerCase();
        const password = loginForm.password.value;
        const users = JSON.parse(localStorage.getItem('users') || '{}');

        if (users[email] && users[email].password === password) {
          showAlert('success', 'Đăng nhập thành công! (Demo – chưa có phiên đăng nhập)');
          loginForm.reset();
          loginForm.classList.remove('was-validated');
        } else {
          showAlert('danger', 'Email hoặc mật khẩu không đúng.');
        }
      });

      // Reset buttons
      document.getElementById('regReset').addEventListener('click', () => {
        regForm.reset();
        regForm.classList.remove('was-validated');
        updateStrength();
      });
      document.getElementById('loginReset').addEventListener('click', () => {
        const loginForm = document.getElementById('loginForm');
        loginForm.reset();
        loginForm.classList.remove('was-validated');
      });
    })();
  </script>
</body>
</html>
